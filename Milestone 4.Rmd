---
title: "Milestone 4"
author: "Bridger Gordon"
date: "10/10/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(readxl)
library(readstata13)
library(janitor)
library(usmap)
library(ggplot2)
```

## Short Description of the Plot Below

I've included two ggplots below -- one which is the traditional geom_point scatterplot and the other is a unique ggplot package to plot the data on a US county map. First, the map of social connectedness from Lawrence County (my home county) shows that people are significantly more likely to be Facebook friends / know each other if they are in western South Dakota or eastern Wyoming + Montana and much less likely to be Facebook friends with people elsewhere in the US. This indicates the restrictions of geography/distance on social connectedness. You also can see the outline of South Dakota and how it is more likely for two people to know each other simply because they are both from South Dakota. Second, the plot of the association between the Social Connectedness Index and the racial demographics of a county. This shows there is an association between the two -- people in Lawrence Co. are more likely to be friends with someone if they are from a majority-white county. There are a lot of potential explanations for this -- self segregation in communities, geography (South Dakota is demographically less diverse than nationally), etc. But it is an interesting association.

```{r data_loading}

# This first CSV file is just the county ids (so it matches the counties names with the IDs that are used in the other datasets to refer to a county).

county_info_ids <- read.csv("raw-data/County_info.csv") %>%
  clean_names()

# This second CSV file shows the relative probability of a social connection between two counties in the US.

county_county_connections <- read.csv("raw-data/County_County.csv") %>%
  clean_names()

# This third CSV file shows the relative probability of a social connection with an American county and a foreign country.

county_country_connections <- read.csv("raw-data/County_Country.csv") %>%
  clean_names()

# This Stata file shows the demographic information about any given county, including race, political preference, etc.

county_demographics <- read.dta13("raw-data/County_Demographics.dta") %>%
  clean_names()

```


```{r ggplot, warning = FALSE}

#Inner-join the data and select just Lawrence County, SD for this purpose (my home county) with its FIPS code (46081). Create the logarithmic probability of the relative probability.

county_with_ids <- inner_join(county_county_connections, county_info_ids, by = "own_county") %>%
  select(own_county, friend_county, rel_prob_friend, level2, level3) %>%
  filter(friend_county == 46081) %>%
  mutate(fips = own_county) %>%
  mutate(log_prob = log(rel_prob_friend))

#Add in the county demographics data for association between FB Social Connectedness Index and information about county demographics.

county_detailed <- inner_join(county_with_ids, county_demographics, by = "fips")

#Use the ggplot plot_usmap function to plot the data based on county FIPS code to show the relative probability of being "socially connected" via Facebook.

plot_usmap(data = county_with_ids, values = "log_prob", regions = "counties", size = 0.05) + 
  theme(panel.background = element_rect(color = "white", fill = "white")) +
  scale_fill_continuous(low = "white", high = "blue4", name = "Rel. Prob.") +
  labs(title = "Map of the Social Connectedness Index for Lawrence County, South Dakota",
       subtitle = "The relative probability of being Facebook friends with someone of another county")

#Plot the association between Social Connectedness and racial diversity and draw line of best fit.

ggplot(county_detailed, aes(x = pct_white_alone, y = log_prob)) +
  geom_point() +
  geom_smooth(method = lm) +
  labs(title = "Relationship between Social Connectedness and Race in Lawrence Co., SD",
       subtitle = "People are more likely to be friends with people in counties that are also majority white.",
       x = "Percentage of Pop. that is White",
       y = "Relative Probability of Social Connectedness")

```

